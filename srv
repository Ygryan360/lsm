
#!/bin/bash

# VÃ©rification de la prÃ©sence de systemctl
if ! command -v systemctl &>/dev/null; then
    echo -e "\e[31msystemctl n'est pas disponible sur ce systÃ¨me.\e[0m"
    exit 1
fi

# VÃ©rification si le script est lancÃ© en root
if [ "$EUID" -ne 0 ]; then
    SUDO="sudo"
else
    SUDO=""
fi

# Fonction gÃ©nÃ©rique pour afficher un menu interactif
menu_selection() {
    local prompt="$1"
    shift
    local options=("$@")
    local selected=0
    while true; do
        clear
        echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
        printf "â”‚   %s\n" "$prompt"            
        echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
        echo ""
        for i in "${!options[@]}"; do
            if [ $i -eq $selected ]; then
                echo -e "â–¶ \e[1;32m[â—] ${options[$i]}\e[0m"
            else
                echo -e "  [â—‹] ${options[$i]}"
            fi
        done

        # Lecture d'une touche sans afficher
        read -sn 1 key
        case "$key" in
            $'\x1b')
                read -sn 2 key
                case "$key" in
                    "[A")  # FlÃ¨che haut
                        ((selected--))
                        if [ $selected -lt 0 ]; then
                            selected=$((${#options[@]} - 1))
                        fi
                        ;;
                    "[B")  # FlÃ¨che bas
                        ((selected++))
                        if [ $selected -ge ${#options[@]} ]; then
                            selected=0
                        fi
                        ;;
                esac
                ;;
            "")  # Touche EntrÃ©e
                return $selected
                ;;
        esac
    done
}


# Fonction pour exÃ©cuter l'action selon le service et l'action choisie
executer_action() {
    local service="$1"
    local action="$2"
    local status_code=0

    case "$service" in
        "Apache & MySQL")
            case "$action" in
                "DÃ©marrer")
                    echo "ğŸš€ DÃ©marrage d'Apache et MySQL..."
                    if ! $SUDO systemctl start httpd; then
                        echo -e "\e[31mErreur lors du dÃ©marrage d'Apache\e[0m"; status_code=1
                    fi
                    if ! $SUDO systemctl start mysqld; then
                        echo -e "\e[31mErreur lors du dÃ©marrage de MySQL\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat d'Apache :"
                    systemctl status httpd | grep -E 'Loaded:|Active:'
                    echo "ğŸ“Œ Ã‰tat de MySQL :"
                    systemctl status mysqld | grep -E 'Loaded:|Active:'
                    ;;
                "Voir le statut")
                    echo "ğŸ“Œ Ã‰tat d'Apache :"
                    systemctl status httpd | grep -E 'Loaded:|Active:'
                    echo "ğŸ“Œ Ã‰tat de MySQL :"
                    systemctl status mysqld | grep -E 'Loaded:|Active:'
                    ;;
                "ArrÃªter")
                    echo "ğŸ›‘ ArrÃªt d'Apache et MySQL..."
                    if ! $SUDO systemctl stop httpd; then
                        echo -e "\e[31mErreur lors de l'arrÃªt d'Apache\e[0m"; status_code=1
                    fi
                    if ! $SUDO systemctl stop mysqld; then
                        echo -e "\e[31mErreur lors de l'arrÃªt de MySQL\e[0m"; status_code=1
                    fi
                    ;;
                "RedÃ©marrer")
                    echo "ğŸ”„ RedÃ©marrage d'Apache et MySQL..."
                    if ! $SUDO systemctl restart httpd; then
                        echo -e "\e[31mErreur lors du redÃ©marrage d'Apache\e[0m"; status_code=1
                    fi
                    if ! $SUDO systemctl restart mysqld; then
                        echo -e "\e[31mErreur lors du redÃ©marrage de MySQL\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat d'Apache :"
                    systemctl status httpd | grep -E 'Loaded:|Active:'
                    echo "ğŸ“Œ Ã‰tat de MySQL :"
                    systemctl status mysqld | grep -E 'Loaded:|Active:'
                    ;;
            esac
            ;;
        "MongoDB")
            case "$action" in
                "DÃ©marrer")
                    echo "ğŸš€ DÃ©marrage de MongoDB..."
                    if ! $SUDO systemctl start mongod; then
                        echo -e "\e[31mErreur lors du dÃ©marrage de MongoDB\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat de MongoDB :"
                    systemctl status mongod | grep -E 'Loaded:|Active:'
                    ;;
                "Voir le statut")
                    echo "ğŸ“Œ Ã‰tat de MongoDB :"
                    systemctl status mongod | grep -E 'Loaded:|Active:'
                    ;;
                "ArrÃªter")
                    echo "ğŸ›‘ ArrÃªt de MongoDB..."
                    if ! $SUDO systemctl stop mongod; then
                        echo -e "\e[31mErreur lors de l'arrÃªt de MongoDB\e[0m"; status_code=1
                    fi
                    ;;
                "RedÃ©marrer")
                    echo "ğŸ”„ RedÃ©marrage de MongoDB..."
                    if ! $SUDO systemctl restart mongod; then
                        echo -e "\e[31mErreur lors du redÃ©marrage de MongoDB\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat de MongoDB :"
                    systemctl status mongod | grep -E 'Loaded:|Active:'
                    ;;
            esac
            ;;
        "PostgreSQL")
            case "$action" in
                "DÃ©marrer")
                    echo "ğŸš€ DÃ©marrage de PostgreSQL..."
                    if ! $SUDO systemctl start postgresql; then
                        echo -e "\e[31mErreur lors du dÃ©marrage de PostgreSQL\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat de PostgreSQL :"
                    systemctl status postgresql | grep -E 'Loaded:|Active:'
                    ;;
                "Voir le statut")
                    echo "ğŸ“Œ Ã‰tat de PostgreSQL :"
                    systemctl status postgresql | grep -E 'Loaded:|Active:'
                    ;;
                "ArrÃªter")
                    echo "ğŸ›‘ ArrÃªt de PostgreSQL..."
                    if ! $SUDO systemctl stop postgresql; then
                        echo -e "\e[31mErreur lors de l'arrÃªt de PostgreSQL\e[0m"; status_code=1
                    fi
                    ;;
                "RedÃ©marrer")
                    echo "ğŸ”„ RedÃ©marrage de PostgreSQL..."
                    if ! $SUDO systemctl restart postgresql; then
                        echo -e "\e[31mErreur lors du redÃ©marrage de PostgreSQL\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat de PostgreSQL :"
                    systemctl status postgresql | grep -E 'Loaded:|Active:'
                    ;;
            esac
            ;;
        "Redis")
            case "$action" in
                "DÃ©marrer")
                    echo "ğŸš€ DÃ©marrage de Redis..."
                    if ! $SUDO systemctl start redis; then
                        echo -e "\e[31mErreur lors du dÃ©marrage de Redis\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat de Redis :"
                    systemctl status redis | grep -E 'Loaded:|Active:'
                    ;;
                "Voir le statut")
                    echo "ğŸ“Œ Ã‰tat de Redis :"
                    systemctl status redis | grep -E 'Loaded:|Active:'
                    ;;
                "ArrÃªter")
                    echo "ğŸ›‘ ArrÃªt de Redis..."
                    if ! $SUDO systemctl stop redis; then
                        echo -e "\e[31mErreur lors de l'arrÃªt de Redis\e[0m"; status_code=1
                    fi
                    ;;
                "RedÃ©marrer")
                    echo "ğŸ”„ RedÃ©marrage de Redis..."
                    if ! $SUDO systemctl restart redis; then
                        echo -e "\e[31mErreur lors du redÃ©marrage de Redis\e[0m"; status_code=1
                    fi
                    echo "ğŸ“Œ Ã‰tat de Redis :"
                    systemctl status redis | grep -E 'Loaded:|Active:'
                    ;;
            esac
            ;;
    esac
    echo ""
    if [ $status_code -eq 0 ]; then
        echo -e "\e[32mAction terminÃ©e avec succÃ¨s.\e[0m"
    else
        echo -e "\e[31mUne ou plusieurs erreurs sont survenues.\e[0m"
    fi
    echo "Appuyez sur une touche pour continuer..."
    read -sn 1
}

# Boucle principale
while true; do
    # Menu des services
    services=("Apache & MySQL" "MongoDB" "PostgreSQL" "Redis" "Quitter")
    menu_selection "SÃ©lectionnez le service :" "${services[@]}"
    service_index=$?
    selected_service="${services[$service_index]}"

    if [ "$selected_service" = "Quitter" ]; then
        clear
        echo "Fermeture..."
        exit 0
    fi

    # Menu des actions
    actions=("DÃ©marrer" "Voir le statut" "ArrÃªter" "RedÃ©marrer" "Retour")
    menu_selection "SÃ©lectionnez l'action pour $selected_service :" "${actions[@]}"
    action_index=$?
    selected_action="${actions[$action_index]}"

    if [ "$selected_action" = "Retour" ]; then
        continue
    else
        clear
        executer_action "$selected_service" "$selected_action"
    fi
done
