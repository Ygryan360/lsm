#!/bin/bash

# Fonction gÃ©nÃ©rique pour afficher un menu interactif
menu_selection() {
    local prompt="$1"
    shift
    local options=("$@")
    local selected=0
    while true; do
        clear
        echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
        printf "â”‚   %s\n" "$prompt"            
        echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
        echo ""
        for i in "${!options[@]}"; do
            if [ $i -eq $selected ]; then
                echo -e "â–¶ \e[1;32m[â—] ${options[$i]}\e[0m"
            else
                echo -e "  [â—‹] ${options[$i]}"
            fi
        done

        # Lecture d'une touche sans afficher
        read -sn 1 key
        case "$key" in
            $'\x1b')
                read -sn 2 key
                case "$key" in
                    "[A")  # FlÃ¨che haut
                        ((selected--))
                        if [ $selected -lt 0 ]; then
                            selected=$((${#options[@]} - 1))
                        fi
                        ;;
                    "[B")  # FlÃ¨che bas
                        ((selected++))
                        if [ $selected -ge ${#options[@]} ]; then
                            selected=0
                        fi
                        ;;
                esac
                ;;
            "")  # Touche EntrÃ©e
                return $selected
                ;;
        esac
    done
}

# Fonction pour exÃ©cuter l'action selon le service et l'action choisie
executer_action() {
    local service="$1"
    local action="$2"

    case "$service" in
        "Apache & MySQL")
            case "$action" in
                "DÃ©marrer")
                    echo "ğŸš€ DÃ©marrage d'Apache et MySQL..."
                    sudo systemctl start apache2
                    sudo systemctl start mysql
                    echo "ğŸ“Œ Ã‰tat d'Apache :"
                    systemctl status apache2 | grep -E 'Loaded:|Active:'
                    echo "ğŸ“Œ Ã‰tat de MySQL :"
                    systemctl status mysql | grep -E 'Loaded:|Active:'
                    ;;
                "Voir le statut")
                    echo "ğŸ“Œ Ã‰tat d'Apache :"
                    systemctl status apache2 | grep -E 'Loaded:|Active:'
                    echo "ğŸ“Œ Ã‰tat de MySQL :"
                    systemctl status mysql | grep -E 'Loaded:|Active:'
                    ;;
                "ArrÃªter")
                    echo "ğŸ›‘ ArrÃªt d'Apache et MySQL..."
                    sudo systemctl stop apache2
                    sudo systemctl stop mysql
                    ;;
            esac
            ;;
        "MongoDB")
            case "$action" in
                "DÃ©marrer")
                    echo "ğŸš€ DÃ©marrage de MongoDB..."
                    sudo systemctl start mongod
                    echo "ğŸ“Œ Ã‰tat de MongoDB :"
                    systemctl status mongod | grep -E 'Loaded:|Active:'
                    ;;
                "Voir le statut")
                    echo "ğŸ“Œ Ã‰tat de MongoDB :"
                    systemctl status mongod | grep -E 'Loaded:|Active:'
                    ;;
                "ArrÃªter")
                    echo "ğŸ›‘ ArrÃªt de MongoDB..."
                    sudo systemctl stop mongod
                    ;;
            esac
            ;;
        "PostgreSQL")
            case "$action" in
                "DÃ©marrer")
                    echo "ğŸš€ DÃ©marrage de PostgreSQL..."
                    sudo systemctl start postgresql
                    echo "ğŸ“Œ Ã‰tat de PostgreSQL :"
                    systemctl status postgresql | grep -E 'Loaded:|Active:'
                    ;;
                "Voir le statut")
                    echo "ğŸ“Œ Ã‰tat de PostgreSQL :"
                    systemctl status postgresql | grep -E 'Loaded:|Active:'
                    ;;
                "ArrÃªter")
                    echo "ğŸ›‘ ArrÃªt de PostgreSQL..."
                    sudo systemctl stop postgresql
                    ;;
            esac
            ;;
    esac
    echo ""
    echo "Appuyez sur une touche pour continuer..."
    read -sn 1
}

# Boucle principale
while true; do
    # Menu des services
    services=("Apache & MySQL" "MongoDB" "PostgreSQL" "Quitter")
    menu_selection "SÃ©lectionnez le service :" "${services[@]}"
    service_index=$?
    selected_service="${services[$service_index]}"

    if [ "$selected_service" = "Quitter" ]; then
        clear
        echo "Fermeture..."
        exit 0
    fi

    # Menu des actions
    actions=("DÃ©marrer" "Voir le statut" "ArrÃªter" "Retour")
    menu_selection "SÃ©lectionnez l'action pour $selected_service :" "${actions[@]}"
    action_index=$?
    selected_action="${actions[$action_index]}"

    if [ "$selected_action" = "Retour" ]; then
        continue
    else
        clear
        executer_action "$selected_service" "$selected_action"
    fi
done
